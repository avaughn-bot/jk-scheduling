<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JK Co. Staff Scheduling System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ============================================
        // GOOGLE APPS SCRIPT CONFIGURATION
        // ============================================
        // REPLACE THIS WITH YOUR WEB APP URL!
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwWfZHCIjVYPVljhw9T_oJq-iUclM0e8xX7Oi5aUVm_kCKk7W4E-TJ0n1TvVsmWIAr3kA/exec';
        // Example: 'https://script.google.com/macros/s/AKfycbyXXXXXXXXXXXXX/exec'

        const SchedulingApp = () => {
            // Default teams based on Excel structure
            const defaultTeams = {
                'Audit - DC': [
                    { name: "Diana", role: "Audit Manager DC" },
                    { name: "Katie", role: "Senior Auditor" },
                    { name: "Lexie", role: "Auditor" },
                    { name: "Robert", role: "Senior Auditor" },
                    { name: "Kevin", role: "Auditor" },
                    { name: "Victor", role: "Auditor" }
                ],
                'Audit - KK': [
                    { name: "Kyle", role: "Audit Manager KK" },
                    { name: "Stephen", role: "Auditor" },
                    { name: "Belal", role: "Auditor" },
                    { name: "Aidan", role: "Auditor" }
                ],
                'Consulting - CM': [
                    { name: "Chris", role: "Consulting Manager CM" },
                    { name: "Heidi", role: "Senior Consultant" },
                    { name: "Meagan", role: "Consultant" },
                    { name: "Mike", role: "Consultant" },
                    { name: "Jane", role: "Consultant" }
                ],
                'Consulting - LP': [
                    { name: "Lauren", role: "Consulting Manager LP" },
                    { name: "Glorija", role: "Consultant" },
                    { name: "Justin", role: "Consultant" },
                    { name: "Allen", role: "Consultant" },
                    { name: "Misty", role: "Consultant" }
                ],
                'Staff': [
                    { name: "Stephanie", role: "Staff Accountant" },
                    { name: "Brandon", role: "Consultant" },
                    { name: "Al", role: "Staff Accountant" },
                    { name: "Isabella", role: "Staff Accountant" },
                    { name: "Cris", role: "Senior Consultant" }
                ]
            };

            const [teams, setTeams] = useState(defaultTeams);

            const offices = {
                'Calumet City': [
                    'CC Desk #1', 'CC Desk #2', 'CC Desk #3', 'CC Desk #4', 'CC Desk #5', 'CC Desk #6',
                    'CC Up Desk #1', 'CC Up Desk #2', 'CC Up Desk #3',
                    'CC Office', 'CC Rec', 'CC Conf'
                ],
                'Mokena': [
                    'Mokena Desk #1', 'Mokena Desk #2', 'Mokena Desk #3',
                    'Mokena Desk #4', 'Mokena Desk #5', 'Mokena Desk #6',
                    'Mokena Office #1', 'Mokena Office #2', 'Mokena Conf'
                ]
            };

            const [currentWeekStart, setCurrentWeekStart] = useState(new Date(2025, 11, 15));
            const [currentMonth, setCurrentMonth] = useState(new Date(2025, 11, 1)); // December 2025
            const [assignments, setAssignments] = useState({});
            const [selectedTeam, setSelectedTeam] = useState('Audit - DC');
            const [viewMode, setViewMode] = useState('schedule');
            const [scheduleView, setScheduleView] = useState('week'); // 'week' or 'month'
            const [modalOpen, setModalOpen] = useState(false);
            const [currentAssignment, setCurrentAssignment] = useState(null);
            const [teamModalOpen, setTeamModalOpen] = useState(false);
            const [staffModalOpen, setStaffModalOpen] = useState(false);
            const [editingStaff, setEditingStaff] = useState(null);
            const [bulkScheduleModalOpen, setBulkScheduleModalOpen] = useState(false);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadDataFromGoogleSheets();
            }, []);

            const loadDataFromGoogleSheets = async () => {
                try {
                    setLoading(true);
                    
                    // Load teams
                    const teamsResponse = await fetch(`${APPS_SCRIPT_URL}?action=loadTeams`);
                    const teamsData = await teamsResponse.json();
                    if (!teamsData.error && Object.keys(teamsData).length > 0) {
                        setTeams(teamsData);
                    }
                    
                    // Load assignments
                    const assignmentsResponse = await fetch(`${APPS_SCRIPT_URL}?action=loadAssignments`);
                    const assignmentsData = await assignmentsResponse.json();
                    if (!assignmentsData.error) {
                        setAssignments(assignmentsData);
                    }
                    
                    setLoading(false);
                } catch (error) {
                    console.error('Error loading data:', error);
                    alert('Failed to load data from Google Sheets. Using default teams. Check console for details.');
                    setLoading(false);
                }
            };

            useEffect(() => {
                // Removed: No longer saving to localStorage
            }, [assignments]);

            useEffect(() => {
                // Removed: No longer saving to localStorage
            }, [teams]);

            const getDaysOfWeek = () => {
                const days = [];
                for (let i = 0; i < 7; i++) {
                    const date = new Date(currentWeekStart);
                    date.setDate(date.getDate() + i);
                    days.push(date);
                }
                return days;
            };

            const getDaysInMonth = () => {
                const year = currentMonth.getFullYear();
                const month = currentMonth.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                
                // Get the day of week for the first day (0 = Sunday)
                const startingDayOfWeek = firstDay.getDay();
                
                const days = [];
                
                // Add empty cells for days before the month starts
                for (let i = 0; i < startingDayOfWeek; i++) {
                    days.push(null);
                }
                
                // Add all days in the month
                for (let day = 1; day <= daysInMonth; day++) {
                    days.push(new Date(year, month, day));
                }
                
                return days;
            };

            const checkDeskConflict = (desk, date, currentStaffName) => {
                if (!desk) return null;
                
                const dateStr = formatDate(date);
                for (const [key, assignment] of Object.entries(assignments)) {
                    // Key format is "StaffName-YYYY-MM-DD"
                    // Find the last occurrence of a date pattern
                    const lastDashIndex = key.lastIndexOf('-');
                    const secondLastDashIndex = key.lastIndexOf('-', lastDashIndex - 1);
                    const thirdLastDashIndex = key.lastIndexOf('-', secondLastDashIndex - 1);
                    
                    const staffName = key.substring(0, thirdLastDashIndex);
                    const assignmentDate = key.substring(thirdLastDashIndex + 1);
                    
                    if (assignmentDate === dateStr && 
                        assignment.desk === desk && 
                        staffName !== currentStaffName) {
                        return staffName;
                    }
                }
                return null;
            };

            const formatDate = (date) => {
                return date.toISOString().split('T')[0];
            };

            const formatDateDisplay = (date) => {
                const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                return `${days[date.getDay()]} ${date.getMonth() + 1}/${date.getDate()}`;
            };

            const openAssignmentModal = (staffName, date) => {
                const key = `${staffName}-${formatDate(date)}`;
                setCurrentAssignment({
                    key,
                    staffName,
                    date: formatDate(date),
                    ...(assignments[key] || {})
                });
                setModalOpen(true);
            };

            const saveAssignment = async (data) => {
                const key = `${data.staffName}-${data.date}`;
                
                // Update local state immediately for responsive UI
                setAssignments(prev => ({
                    ...prev,
                    [key]: {
                        location: data.location,
                        task: data.task,
                        desk: data.desk,
                        classification: data.classification,
                        clientName: data.clientName || ''
                    }
                }));
                
                setModalOpen(false);
                setCurrentAssignment(null);
                
                // Save to Google Sheets in background
                try {
                    const response = await fetch(APPS_SCRIPT_URL, {
                        method: 'POST',
                        body: JSON.stringify({
                            action: 'saveAssignment',
                            key: key,
                            assignment: {
                                location: data.location,
                                task: data.task,
                                desk: data.desk,
                                classification: data.classification,
                                clientName: data.clientName || ''
                            }
                        })
                    });
                    const result = await response.json();
                    if (result.error) {
                        console.error('Error saving to Google Sheets:', result.error);
                        alert('Warning: Assignment saved locally but may not have synced to Google Sheets.');
                    }
                } catch (error) {
                    console.error('Error saving to Google Sheets:', error);
                    alert('Warning: Assignment saved locally but may not have synced to Google Sheets.');
                }
            };

            const deleteAssignment = async () => {
                if (currentAssignment) {
                    // Update local state immediately
                    setAssignments(prev => {
                        const newAssignments = { ...prev };
                        delete newAssignments[currentAssignment.key];
                        return newAssignments;
                    });
                    
                    setModalOpen(false);
                    setCurrentAssignment(null);
                    
                    // Delete from Google Sheets in background
                    try {
                        const response = await fetch(APPS_SCRIPT_URL, {
                            method: 'POST',
                            body: JSON.stringify({
                                action: 'deleteAssignment',
                                key: currentAssignment.key
                            })
                        });
                        const result = await response.json();
                        if (result.error) {
                            console.error('Error deleting from Google Sheets:', result.error);
                        }
                    } catch (error) {
                        console.error('Error deleting from Google Sheets:', error);
                    }
                }
            };

            const prevWeek = () => {
                setCurrentWeekStart(prev => {
                    const newDate = new Date(prev);
                    newDate.setDate(newDate.getDate() - 7);
                    return newDate;
                });
            };

            const nextWeek = () => {
                setCurrentWeekStart(prev => {
                    const newDate = new Date(prev);
                    newDate.setDate(newDate.getDate() + 7);
                    return newDate;
                });
            };

            const prevMonth = () => {
                setCurrentMonth(prev => {
                    const newDate = new Date(prev);
                    newDate.setMonth(newDate.getMonth() - 1);
                    return newDate;
                });
            };

            const nextMonth = () => {
                setCurrentMonth(prev => {
                    const newDate = new Date(prev);
                    newDate.setMonth(newDate.getMonth() + 1);
                    return newDate;
                });
            };

            const getDeskOccupant = (desk, date) => {
                const dateStr = formatDate(date);
                for (const [key, assignment] of Object.entries(assignments)) {
                    if (key.includes(dateStr) && assignment.desk === desk) {
                        return key.split('-')[0];
                    }
                }
                return null;
            };

            const getStats = () => {
                const today = formatDate(new Date());
                let scheduledToday = 0;
                let occupiedDesks = new Set();

                Object.entries(assignments).forEach(([key, assignment]) => {
                    if (key.includes(today)) {
                        scheduledToday++;
                        if (assignment.desk) {
                            occupiedDesks.add(assignment.desk);
                        }
                    }
                });

                const totalDesks = offices['Calumet City'].length + offices['Mokena'].length;
                const availableDesks = totalDesks - occupiedDesks.size;

                return { scheduledToday, availableDesks };
            };

            const addStaffMember = async (teamName, staffData) => {
                const updatedTeams = {
                    ...teams,
                    [teamName]: [...teams[teamName], staffData]
                };
                
                setTeams(updatedTeams);
                setStaffModalOpen(false);
                setEditingStaff(null);
                
                // Save to Google Sheets
                try {
                    await fetch(APPS_SCRIPT_URL, {
                        method: 'POST',
                        body: JSON.stringify({
                            action: 'saveTeams',
                            teams: updatedTeams
                        })
                    });
                } catch (error) {
                    console.error('Error saving teams:', error);
                    alert('Warning: Staff member added locally but may not have synced to Google Sheets.');
                }
            };

            const updateStaffMember = async (teamName, oldName, newData) => {
                const updatedTeams = {
                    ...teams,
                    [teamName]: teams[teamName].map(member => 
                        member.name === oldName ? newData : member
                    )
                };
                
                setTeams(updatedTeams);
                
                // Update assignments with new name if name changed
                if (oldName !== newData.name) {
                    setAssignments(prev => {
                        const updated = {};
                        Object.entries(prev).forEach(([key, value]) => {
                            const newKey = key.replace(oldName, newData.name);
                            updated[newKey] = value;
                        });
                        return updated;
                    });
                }
                
                setStaffModalOpen(false);
                setEditingStaff(null);
                
                // Save to Google Sheets
                try {
                    await fetch(APPS_SCRIPT_URL, {
                        method: 'POST',
                        body: JSON.stringify({
                            action: 'saveTeams',
                            teams: updatedTeams
                        })
                    });
                } catch (error) {
                    console.error('Error saving teams:', error);
                    alert('Warning: Staff member updated locally but may not have synced to Google Sheets.');
                }
            };

            const removeStaffMember = async (teamName, staffName) => {
                try {
                    alert(`DEBUG: removeStaffMember called for ${staffName} in ${teamName}`);
                    
                    if (!confirm(`Remove ${staffName} from ${teamName}? This will also delete all their assignments.`)) {
                        alert('DEBUG: User cancelled removal');
                        return;
                    }
                    
                    alert('DEBUG: User confirmed removal, updating state...');
                    
                    const updatedTeams = {
                        ...teams,
                        [teamName]: teams[teamName].filter(member => member.name !== staffName)
                    };
                    
                    setTeams(updatedTeams);
                    alert('DEBUG: State updated, now removing assignments...');
                    
                    // Remove all assignments for this staff member
                    setAssignments(prev => {
                        const updated = {};
                        Object.entries(prev).forEach(([key, value]) => {
                            if (!key.startsWith(staffName + '-')) {
                                updated[key] = value;
                            }
                        });
                        return updated;
                    });
                    
                    alert('DEBUG: Assignments removed, now saving to Google Sheets...');
                    
                    // Save to Google Sheets
                    if (APPS_SCRIPT_URL === 'PASTE_YOUR_WEB_APP_URL_HERE') {
                        alert('WARNING: Google Apps Script URL not configured! Changes will be lost on refresh.');
                        return;
                    }
                    
                    try {
                        const response = await fetch(APPS_SCRIPT_URL, {
                            method: 'POST',
                            body: JSON.stringify({
                                action: 'saveTeams',
                                teams: updatedTeams
                            })
                        });
                        const result = await response.json();
                        alert('DEBUG: Saved to Google Sheets successfully!');
                    } catch (error) {
                        console.error('Error saving teams:', error);
                        alert('Warning: Staff member removed locally but may not have synced to Google Sheets. Error: ' + error.message);
                    }
                } catch (error) {
                    alert('CRITICAL ERROR in removeStaffMember: ' + error.message);
                    console.error('Full error:', error);
                }
            };

            const addTeam = async (teamName) => {
                if (teamName && !teams[teamName]) {
                    const updatedTeams = {
                        ...teams,
                        [teamName]: []
                    };
                    
                    setTeams(updatedTeams);
                    setSelectedTeam(teamName);
                    setTeamModalOpen(false);
                    
                    // Save to Google Sheets
                    try {
                        await fetch(APPS_SCRIPT_URL, {
                            method: 'POST',
                            body: JSON.stringify({
                                action: 'saveTeams',
                                teams: updatedTeams
                            })
                        });
                    } catch (error) {
                        console.error('Error saving teams:', error);
                        alert('Warning: Team added locally but may not have synced to Google Sheets.');
                    }
                } else {
                    setTeamModalOpen(false);
                }
            };

            const removeTeam = async (teamName) => {
                if (confirm(`Delete team "${teamName}" and all its members? This will also delete all assignments for this team.`)) {
                    const updatedTeams = { ...teams };
                    delete updatedTeams[teamName];
                    
                    setTeams(updatedTeams);
                    
                    // Remove all assignments for team members
                    const teamMembers = teams[teamName].map(m => m.name);
                    setAssignments(prev => {
                        const updated = {};
                        Object.entries(prev).forEach(([key, value]) => {
                            const staffName = key.split('-')[0];
                            if (!teamMembers.includes(staffName)) {
                                updated[key] = value;
                            }
                        });
                        return updated;
                    });
                    
                    // Select first remaining team
                    const remainingTeams = Object.keys(teams).filter(t => t !== teamName);
                    if (remainingTeams.length > 0) {
                        setSelectedTeam(remainingTeams[0]);
                    }
                    
                    // Save to Google Sheets
                    try {
                        await fetch(APPS_SCRIPT_URL, {
                            method: 'POST',
                            body: JSON.stringify({
                                action: 'saveTeams',
                                teams: updatedTeams
                            })
                        });
                    } catch (error) {
                        console.error('Error saving teams:', error);
                        alert('Warning: Team removed locally but may not have synced to Google Sheets.');
                    }
                }
            };

            const stats = getStats();
            const totalStaff = Object.values(teams).flat().length;

            return (
                <div style={styles.container}>
                    {loading ? (
                        <div style={styles.loadingContainer}>
                            <div style={styles.loadingSpinner}></div>
                            <div style={styles.loadingText}>Loading schedule from Google Sheets...</div>
                        </div>
                    ) : (
                        <>
                    <div style={styles.header}>
                        <h1 style={styles.title}>üìÖ John Kasperek Co. Scheduling</h1>
                        <div style={styles.headerControls}>
                            {/* Week/Month View Toggle */}
                            {viewMode === 'schedule' && (
                                <div style={styles.viewToggle}>
                                    <button
                                        onClick={() => setScheduleView('week')}
                                        style={{...styles.viewButton, ...(scheduleView === 'week' ? styles.viewButtonActive : {})}}
                                    >
                                        Week
                                    </button>
                                    <button
                                        onClick={() => setScheduleView('month')}
                                        style={{...styles.viewButton, ...(scheduleView === 'month' ? styles.viewButtonActive : {})}}
                                    >
                                        Month
                                    </button>
                                </div>
                            )}

                            {/* Week/Month Navigation */}
                            <div style={styles.weekNav}>
                                <button 
                                    onClick={scheduleView === 'week' ? prevWeek : prevMonth} 
                                    style={styles.navButton}
                                >
                                    ‚óÄ Prev
                                </button>
                                <div style={styles.weekDisplay}>
                                    {scheduleView === 'week' 
                                        ? `Week of ${currentWeekStart.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`
                                        : currentMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })
                                    }
                                </div>
                                <button 
                                    onClick={scheduleView === 'week' ? nextWeek : nextMonth} 
                                    style={styles.navButton}
                                >
                                    Next ‚ñ∂
                                </button>
                            </div>

                            {/* Page View Toggle */}
                            <div style={styles.viewToggle}>
                                <button
                                    onClick={() => setViewMode('schedule')}
                                    style={{...styles.viewButton, ...(viewMode === 'schedule' ? styles.viewButtonActive : {})}}
                                >
                                    Schedule
                                </button>
                                <button
                                    onClick={() => setViewMode('desks')}
                                    style={{...styles.viewButton, ...(viewMode === 'desks' ? styles.viewButtonActive : {})}}
                                >
                                    Desks
                                </button>
                                <button
                                    onClick={() => setViewMode('teams')}
                                    style={{...styles.viewButton, ...(viewMode === 'teams' ? styles.viewButtonActive : {})}}
                                >
                                    Manage Teams
                                </button>
                            </div>

                            {/* Bulk Schedule Button */}
                            {viewMode === 'schedule' && (
                                <button
                                    onClick={() => setBulkScheduleModalOpen(true)}
                                    style={styles.bulkScheduleButton}
                                >
                                    üìÖ Bulk Schedule Month
                                </button>
                            )}
                        </div>
                    </div>

                    <div style={styles.statsBar}>
                        <div style={styles.statCard}>
                            <div style={styles.statValue}>{totalStaff}</div>
                            <div style={styles.statLabel}>Total Staff</div>
                        </div>
                        <div style={styles.statCard}>
                            <div style={styles.statValue}>{stats.scheduledToday}</div>
                            <div style={styles.statLabel}>Scheduled Today</div>
                        </div>
                        <div style={styles.statCard}>
                            <div style={styles.statValue}>{stats.availableDesks}</div>
                            <div style={styles.statLabel}>Available Desks</div>
                        </div>
                        <div style={styles.statCard}>
                            <div style={styles.statValue}>{Object.keys(assignments).length}</div>
                            <div style={styles.statLabel}>Total Assignments</div>
                        </div>
                    </div>

                    {viewMode === 'schedule' ? (
                        <div>
                            <div style={styles.teamSelector}>
                                {Object.keys(teams).map(team => (
                                    <button
                                        key={team}
                                        onClick={() => setSelectedTeam(team)}
                                        style={{
                                            ...styles.teamButton,
                                            ...(selectedTeam === team ? styles.teamButtonActive : {})
                                        }}
                                    >
                                        {team}
                                    </button>
                                ))}
                            </div>

                            <div style={styles.scheduleContainer}>
                                {scheduleView === 'week' ? (
                                    <div style={styles.scheduleGrid}>
                                        <div style={{...styles.gridHeader, ...styles.staffColumn}}>Staff</div>
                                        {getDaysOfWeek().map((date, i) => (
                                            <div key={i} style={styles.gridHeader}>
                                                {formatDateDisplay(date)}
                                            </div>
                                        ))}

                                        {teams[selectedTeam].map(person => (
                                            <React.Fragment key={person.name}>
                                                <div style={styles.staffCell}>
                                                    <div style={styles.staffName}>{person.name}</div>
                                                    <div style={styles.staffRole}>{person.role}</div>
                                                </div>
                                                {getDaysOfWeek().map((date, i) => {
                                                    const key = `${person.name}-${formatDate(date)}`;
                                                    const assignment = assignments[key];
                                                    return (
                                                        <div
                                                            key={i}
                                                            onClick={() => openAssignmentModal(person.name, date)}
                                                            style={{
                                                                ...styles.dayCell,
                                                                ...(assignment ? styles.dayCellAssigned : {})
                                                            }}
                                                        >
                                                            {assignment && (
                                                                <div style={styles.assignment}>
                                                                    <div style={styles.assignmentLocation}>
                                                                        {assignment.location === 'Client' && assignment.clientName 
                                                                            ? `${assignment.clientName}` 
                                                                            : assignment.location}
                                                                    </div>
                                                                    <div style={styles.assignmentTask}>
                                                                        {assignment.task?.substring(0, 50)}{assignment.task?.length > 50 ? '...' : ''}
                                                                    </div>
                                                                    {assignment.desk && (
                                                                        <div style={styles.assignmentDesk}>{assignment.desk}</div>
                                                                    )}
                                                                </div>
                                                            )}
                                                        </div>
                                                    );
                                                })}
                                            </React.Fragment>
                                        ))}
                                    </div>
                                ) : (
                                    <div>
                                        {/* Month Calendar Header */}
                                        <div style={styles.monthCalendarHeader}>
                                            {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                                                <div key={day} style={styles.monthDayHeader}>{day}</div>
                                            ))}
                                        </div>
                                        
                                        {/* Month Calendar Grid */}
                                        <div style={styles.monthCalendarGrid}>
                                            {getDaysInMonth().map((date, i) => (
                                                <div key={i} style={date ? styles.monthDayCell : styles.monthEmptyCell}>
                                                    {date && (
                                                        <>
                                                            <div style={styles.monthDayNumber}>{date.getDate()}</div>
                                                            <div style={styles.monthAssignments}>
                                                                {teams[selectedTeam].map(person => {
                                                                    const key = `${person.name}-${formatDate(date)}`;
                                                                    const assignment = assignments[key];
                                                                    if (assignment) {
                                                                        const displayLocation = assignment.location === 'Client' && assignment.clientName 
                                                                            ? assignment.clientName 
                                                                            : assignment.location;
                                                                        return (
                                                                            <div
                                                                                key={person.name}
                                                                                onClick={() => openAssignmentModal(person.name, date)}
                                                                                style={styles.monthAssignmentBadge}
                                                                                title={`${person.name} - ${displayLocation}`}
                                                                            >
                                                                                {person.name}: {displayLocation}
                                                                            </div>
                                                                        );
                                                                    }
                                                                    return null;
                                                                })}
                                                                <div
                                                                    style={styles.addAssignmentBtn}
                                                                    onClick={() => {
                                                                        // Show a simple selector for staff member
                                                                        const staffName = prompt(`Select staff member from ${selectedTeam}:\n\n` + 
                                                                            teams[selectedTeam].map((p, i) => `${i+1}. ${p.name}`).join('\n') +
                                                                            '\n\nEnter the number:');
                                                                        if (staffName) {
                                                                            const index = parseInt(staffName) - 1;
                                                                            if (index >= 0 && index < teams[selectedTeam].length) {
                                                                                openAssignmentModal(teams[selectedTeam][index].name, date);
                                                                            }
                                                                        }
                                                                    }}
                                                                >
                                                                    + Add
                                                                </div>
                                                            </div>
                                                        </>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    ) : viewMode === 'desks' ? (
                        <div style={styles.deskView}>
                            {Object.entries(offices).map(([officeName, deskList]) => (
                                <div key={officeName} style={styles.officeSection}>
                                    <h3 style={styles.officeTitle}>üè¢ {officeName} Office</h3>
                                    <div style={styles.deskGrid}>
                                        {deskList.map(desk => {
                                            const occupant = getDeskOccupant(desk, new Date());
                                            return (
                                                <div
                                                    key={desk}
                                                    style={{
                                                        ...styles.deskCard,
                                                        ...(occupant ? styles.deskCardOccupied : {})
                                                    }}
                                                >
                                                    <div style={styles.deskName}>{desk}</div>
                                                    <div style={styles.deskOccupant}>{occupant || 'Available'}</div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div style={styles.teamManagement}>
                            <div style={styles.managementHeader}>
                                <h2 style={styles.managementTitle}>Team Management</h2>
                                <button onClick={() => setTeamModalOpen(true)} style={styles.addTeamBtn}>
                                    + Add New Team
                                </button>
                            </div>

                            {Object.entries(teams).map(([teamName, members]) => (
                                <div key={teamName} style={styles.teamManagementCard}>
                                    <div style={styles.teamCardHeader}>
                                        <h3 style={styles.teamCardTitle}>{teamName}</h3>
                                        <div style={styles.teamCardActions}>
                                            <button 
                                                onClick={() => {
                                                    setEditingStaff({ teamName, isNew: true });
                                                    setStaffModalOpen(true);
                                                }} 
                                                style={styles.addStaffBtn}
                                            >
                                                + Add Staff
                                            </button>
                                            <button 
                                                onClick={() => removeTeam(teamName)} 
                                                style={styles.deleteTeamBtn}
                                            >
                                                Delete Team
                                            </button>
                                        </div>
                                    </div>
                                    <div style={styles.staffMembersList}>
                                        {members.length === 0 ? (
                                            <p style={styles.emptyTeam}>No staff members in this team yet.</p>
                                        ) : (
                                            members.map(member => (
                                                <div key={member.name} style={styles.staffMemberCard}>
                                                    <div>
                                                        <div style={styles.memberName}>{member.name}</div>
                                                        <div style={styles.memberRole}>{member.role}</div>
                                                    </div>
                                                    <div style={styles.memberActions}>
                                                        <button 
                                                            onClick={() => {
                                                                setEditingStaff({ teamName, member, isNew: false });
                                                                setStaffModalOpen(true);
                                                            }}
                                                            style={styles.editBtn}
                                                        >
                                                            Edit
                                                        </button>
                                                        <button 
                                                            onClick={(e) => {
                                                                e.preventDefault();
                                                                removeStaffMember(teamName, member.name);
                                                            }}
                                                            style={styles.removeBtn}
                                                        >
                                                            Remove
                                                        </button>
                                                    </div>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    {modalOpen && (
                        <AssignmentModal
                            assignment={currentAssignment}
                            offices={offices}
                            onSave={saveAssignment}
                            onDelete={deleteAssignment}
                            onClose={() => {
                                setModalOpen(false);
                                setCurrentAssignment(null);
                            }}
                            checkDeskConflict={checkDeskConflict}
                        />
                    )}

                    {teamModalOpen && (
                        <AddTeamModal
                            onSave={addTeam}
                            onClose={() => setTeamModalOpen(false)}
                        />
                    )}

                    {staffModalOpen && (
                        <StaffModal
                            editingStaff={editingStaff}
                            onSave={async (data) => {
                                if (editingStaff.isNew) {
                                    await addStaffMember(editingStaff.teamName, data);
                                } else {
                                    await updateStaffMember(editingStaff.teamName, editingStaff.member.name, data);
                                }
                            }}
                            onClose={() => {
                                setStaffModalOpen(false);
                                setEditingStaff(null);
                            }}
                        />
                    )}

                    {bulkScheduleModalOpen && (
                        <BulkScheduleModal
                            teams={teams}
                            selectedTeam={selectedTeam}
                            currentMonth={currentMonth}
                            offices={offices}
                            assignments={assignments}
                            onSave={async (bulkAssignments) => {
                                // Update local state immediately
                                setAssignments(prev => ({...prev, ...bulkAssignments}));
                                setBulkScheduleModalOpen(false);
                                
                                // Save all assignments to Google Sheets in background
                                try {
                                    const savePromises = Object.entries(bulkAssignments).map(([key, assignment]) => 
                                        fetch(APPS_SCRIPT_URL, {
                                            method: 'POST',
                                            body: JSON.stringify({
                                                action: 'saveAssignment',
                                                key: key,
                                                assignment: assignment
                                            })
                                        })
                                    );
                                    await Promise.all(savePromises);
                                } catch (error) {
                                    console.error('Error saving bulk assignments:', error);
                                    alert('Warning: Some assignments may not have synced to Google Sheets.');
                                }
                            }}
                            onClose={() => setBulkScheduleModalOpen(false)}
                        />
                    )}
                    </>
                    )}
                </div>
            );
        };

        const AssignmentModal = ({ assignment, offices, onSave, onDelete, onClose, checkDeskConflict }) => {
            const [formData, setFormData] = useState({
                staffName: assignment.staffName,
                date: assignment.date,
                location: assignment.location || '',
                task: assignment.task || '',
                desk: assignment.desk || '',
                classification: assignment.classification || 'Audit',
                clientName: assignment.clientName || ''
            });
            const [deskConflict, setDeskConflict] = useState(null);

            useEffect(() => {
                if (formData.desk && checkDeskConflict) {
                    const date = new Date(formData.date);
                    const conflict = checkDeskConflict(formData.desk, date, formData.staffName);
                    setDeskConflict(conflict);
                } else {
                    setDeskConflict(null);
                }
            }, [formData.desk, checkDeskConflict]);

            const handleSubmit = (e) => {
                e.preventDefault();
                
                if (deskConflict) {
                    if (!confirm(`Warning: ${deskConflict} is already assigned to ${formData.desk} on this date. Do you want to proceed anyway? This will create a conflict.`)) {
                        return;
                    }
                }
                
                onSave(formData);
            };

            const availableDesks = formData.location === 'Calumet City' ? offices['Calumet City'] :
                                 formData.location === 'Mokena' ? offices['Mokena'] : [];

            return (
                <div style={styles.modalOverlay} onClick={onClose}>
                    <div style={styles.modalContent} onClick={(e) => e.stopPropagation()}>
                        <div style={styles.modalHeader}>
                            <h2 style={styles.modalTitle}>
                                {assignment.location ? 'Edit' : 'Add'} Assignment - {assignment.staffName}
                            </h2>
                            <button onClick={onClose} style={styles.closeButton}>√ó</button>
                        </div>

                        <form onSubmit={handleSubmit}>
                            <div style={styles.formGroup}>
                                <label style={styles.label}>Date</label>
                                <input
                                    type="text"
                                    value={(() => {
                                        const [year, month, day] = formData.date.split('-');
                                        const dateObj = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
                                        return dateObj.toLocaleDateString('en-US', { 
                                            weekday: 'long', 
                                            year: 'numeric', 
                                            month: 'long', 
                                            day: 'numeric' 
                                        });
                                    })()}
                                    style={styles.input}
                                    disabled
                                />
                            </div>

                            <div style={styles.formGroup}>
                                <label style={styles.label}>Location</label>
                                <select
                                    value={formData.location}
                                    onChange={(e) => setFormData({...formData, location: e.target.value, desk: '', clientName: ''})}
                                    style={styles.input}
                                    required
                                >
                                    <option value="">Select location...</option>
                                    <option value="Calumet City">Calumet City</option>
                                    <option value="Mokena">Mokena</option>
                                    <option value="WFH">Work From Home</option>
                                    <option value="Client">Client Site</option>
                                    <option value="PTO">PTO/Off</option>
                                    <option value="Holiday">Holiday</option>
                                </select>
                            </div>

                            {formData.location === 'Client' && (
                                <div style={styles.formGroup}>
                                    <label style={styles.label}>Client Name</label>
                                    <input
                                        type="text"
                                        value={formData.clientName || ''}
                                        onChange={(e) => setFormData({...formData, clientName: e.target.value})}
                                        style={styles.input}
                                        placeholder="e.g., Smith & Associates, ABC Corp"
                                        required
                                    />
                                </div>
                            )}

                            <div style={styles.formGroup}>
                                <label style={styles.label}>Task/Project</label>
                                <textarea
                                    value={formData.task}
                                    onChange={(e) => setFormData({...formData, task: e.target.value})}
                                    style={{...styles.input, ...styles.textarea}}
                                    placeholder="Describe the task or project..."
                                    required
                                />
                            </div>

                            {(formData.location === 'Calumet City' || formData.location === 'Mokena') && (
                                <div style={styles.formGroup}>
                                    <label style={styles.label}>
                                        Desk Assignment
                                        {deskConflict && (
                                            <span style={styles.conflictWarning}>
                                                ‚ö†Ô∏è Conflict: {deskConflict} has this desk
                                            </span>
                                        )}
                                    </label>
                                    <select
                                        value={formData.desk}
                                        onChange={(e) => setFormData({...formData, desk: e.target.value})}
                                        style={{
                                            ...styles.input,
                                            ...(deskConflict ? styles.inputConflict : {})
                                        }}
                                    >
                                        <option value="">No desk assigned</option>
                                        {availableDesks.map(desk => {
                                            const occupant = checkDeskConflict ? checkDeskConflict(desk, new Date(formData.date), formData.staffName) : null;
                                            return (
                                                <option key={desk} value={desk}>
                                                    {desk} {occupant ? `(‚ö†Ô∏è ${occupant})` : '(Available)'}
                                                </option>
                                            );
                                        })}
                                    </select>
                                </div>
                            )}

                            <div style={styles.formGroup}>
                                <label style={styles.label}>Classification</label>
                                <select
                                    value={formData.classification}
                                    onChange={(e) => setFormData({...formData, classification: e.target.value})}
                                    style={styles.input}
                                >
                                    <option value="Audit">Audit</option>
                                    <option value="Consulting">Consulting</option>
                                    <option value="Both">Both</option>
                                </select>
                            </div>

                            <div style={styles.buttonGroup}>
                                <button type="submit" style={styles.saveButton}>
                                    {deskConflict ? 'Save (Override Conflict)' : 'Save Assignment'}
                                </button>
                                {assignment.location && (
                                    <button type="button" onClick={onDelete} style={styles.deleteButton}>
                                        Delete
                                    </button>
                                )}
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        const AddTeamModal = ({ onSave, onClose }) => {
            const [teamName, setTeamName] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(teamName);
                setTeamName('');
            };

            return (
                <div style={styles.modalOverlay} onClick={onClose}>
                    <div style={styles.modalContent} onClick={(e) => e.stopPropagation()}>
                        <div style={styles.modalHeader}>
                            <h2 style={styles.modalTitle}>Add New Team</h2>
                            <button onClick={onClose} style={styles.closeButton}>√ó</button>
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div style={styles.formGroup}>
                                <label style={styles.label}>Team Name</label>
                                <input
                                    type="text"
                                    value={teamName}
                                    onChange={(e) => setTeamName(e.target.value)}
                                    style={styles.input}
                                    placeholder="e.g., Audit - New Team"
                                    required
                                />
                            </div>
                            <div style={styles.buttonGroup}>
                                <button type="submit" style={styles.saveButton}>Create Team</button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        const StaffModal = ({ editingStaff, onSave, onClose }) => {
            const [formData, setFormData] = useState({
                name: editingStaff?.member?.name || '',
                role: editingStaff?.member?.role || ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
            };

            return (
                <div style={styles.modalOverlay} onClick={onClose}>
                    <div style={styles.modalContent} onClick={(e) => e.stopPropagation()}>
                        <div style={styles.modalHeader}>
                            <h2 style={styles.modalTitle}>
                                {editingStaff?.isNew ? 'Add' : 'Edit'} Staff Member - {editingStaff?.teamName}
                            </h2>
                            <button onClick={onClose} style={styles.closeButton}>√ó</button>
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div style={styles.formGroup}>
                                <label style={styles.label}>Name</label>
                                <input
                                    type="text"
                                    value={formData.name}
                                    onChange={(e) => setFormData({...formData, name: e.target.value})}
                                    style={styles.input}
                                    placeholder="Enter staff name"
                                    required
                                />
                            </div>
                            <div style={styles.formGroup}>
                                <label style={styles.label}>Role/Title</label>
                                <input
                                    type="text"
                                    value={formData.role}
                                    onChange={(e) => setFormData({...formData, role: e.target.value})}
                                    style={styles.input}
                                    placeholder="e.g., Senior Auditor"
                                    required
                                />
                            </div>
                            <div style={styles.buttonGroup}>
                                <button type="submit" style={styles.saveButton}>
                                    {editingStaff?.isNew ? 'Add' : 'Update'} Staff Member
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        const BulkScheduleModal = ({ teams, selectedTeam, currentMonth, offices, assignments, onSave, onClose }) => {
            const [formData, setFormData] = useState({
                location: '',
                task: '',
                desk: '',
                clientName: '',
                classification: 'Audit',
                dateRangeType: 'month', // 'month' or 'custom'
                startDate: '',
                endDate: '',
                daysOfWeek: {
                    monday: true,
                    tuesday: true,
                    wednesday: true,
                    thursday: true,
                    friday: true,
                    saturday: false,
                    sunday: false
                },
                applyToStaff: 'all' // 'all' or specific staff member names
            });

            const teamMembers = teams[selectedTeam] || [];
            const [selectedStaff, setSelectedStaff] = useState([]);
            const [conflictWarning, setConflictWarning] = useState('');

            // Initialize date range when switching to custom
            useEffect(() => {
                if (formData.dateRangeType === 'custom' && !formData.startDate) {
                    const today = new Date();
                    const nextWeek = new Date(today);
                    nextWeek.setDate(nextWeek.getDate() + 14);
                    
                    setFormData(prev => ({
                        ...prev,
                        startDate: today.toISOString().split('T')[0],
                        endDate: nextWeek.toISOString().split('T')[0]
                    }));
                }
            }, [formData.dateRangeType]);

            // Get the date range to schedule based on type
            const getDateRange = () => {
                if (formData.dateRangeType === 'month') {
                    const year = currentMonth.getFullYear();
                    const month = currentMonth.getMonth();
                    return {
                        start: new Date(year, month, 1),
                        end: new Date(year, month + 1, 0)
                    };
                } else {
                    return {
                        start: new Date(formData.startDate),
                        end: new Date(formData.endDate)
                    };
                }
            };

            // Check for desk conflicts in bulk scheduling
            useEffect(() => {
                if (!formData.desk || (formData.location !== 'Calumet City' && formData.location !== 'Mokena')) {
                    setConflictWarning('');
                    return;
                }

                if (formData.dateRangeType === 'custom' && (!formData.startDate || !formData.endDate)) {
                    setConflictWarning('');
                    return;
                }

                const { start: startDate, end: endDate } = getDateRange();
                
                const dayMapping = {
                    sunday: 0,
                    monday: 1,
                    tuesday: 2,
                    wednesday: 3,
                    thursday: 4,
                    friday: 5,
                    saturday: 6
                };

                const staffToSchedule = formData.applyToStaff === 'all' 
                    ? teamMembers 
                    : teamMembers.filter(m => selectedStaff.includes(m.name));

                let conflictDays = [];
                
                // Iterate through all days in the range
                const currentDate = new Date(startDate);
                while (currentDate <= endDate) {
                    const dayOfWeek = currentDate.getDay();
                    const dayName = Object.keys(dayMapping).find(k => dayMapping[k] === dayOfWeek);
                    
                    if (formData.daysOfWeek[dayName]) {
                        const dateStr = currentDate.toISOString().split('T')[0];
                        
                        // Check existing assignments for this desk on this date
                        const existingAssignments = Object.entries(assignments).filter(([key, assignment]) => {
                            return key.includes(dateStr) && 
                                   assignment.desk === formData.desk &&
                                   !staffToSchedule.some(s => key.startsWith(s.name + '-'));
                        });

                        if (existingAssignments.length > 0) {
                            const conflictingStaff = existingAssignments[0][0].split('-')[0];
                            conflictDays.push(`${currentDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} (${conflictingStaff})`);
                        }
                    }
                    
                    currentDate.setDate(currentDate.getDate() + 1);
                }

                if (conflictDays.length > 0) {
                    if (conflictDays.length <= 3) {
                        setConflictWarning(`‚ö†Ô∏è Desk conflicts on: ${conflictDays.join(', ')}`);
                    } else {
                        setConflictWarning(`‚ö†Ô∏è ${conflictDays.length} desk conflicts detected. First 3: ${conflictDays.slice(0, 3).join(', ')}`);
                    }
                } else {
                    setConflictWarning('');
                }
            }, [formData.desk, formData.location, formData.daysOfWeek, formData.applyToStaff, formData.dateRangeType, formData.startDate, formData.endDate, selectedStaff, currentMonth, teamMembers, assignments]);

            const handleSubmit = (e) => {
                e.preventDefault();
                
                // Validate custom date range
                if (formData.dateRangeType === 'custom') {
                    if (!formData.startDate || !formData.endDate) {
                        alert('Please select both start and end dates.');
                        return;
                    }
                    if (new Date(formData.startDate) > new Date(formData.endDate)) {
                        alert('Start date must be before end date.');
                        return;
                    }
                }
                
                // Confirm if there are conflicts
                if (conflictWarning) {
                    if (!confirm(`${conflictWarning}\n\nDo you want to proceed anyway? This will create conflicting desk assignments.`)) {
                        return;
                    }
                }
                
                const { start: startDate, end: endDate } = getDateRange();
                
                const dayMapping = {
                    sunday: 0,
                    monday: 1,
                    tuesday: 2,
                    wednesday: 3,
                    thursday: 4,
                    friday: 5,
                    saturday: 6
                };
                
                // Create assignments for selected days
                const newAssignments = {};
                const staffToSchedule = formData.applyToStaff === 'all' 
                    ? teamMembers 
                    : teamMembers.filter(m => selectedStaff.includes(m.name));
                
                // Iterate through all days in the range
                const currentDate = new Date(startDate);
                while (currentDate <= endDate) {
                    const dayOfWeek = currentDate.getDay();
                    const dayName = Object.keys(dayMapping).find(k => dayMapping[k] === dayOfWeek);
                    
                    // Check if this day of week is selected
                    if (formData.daysOfWeek[dayName]) {
                        staffToSchedule.forEach(member => {
                            const dateStr = currentDate.toISOString().split('T')[0];
                            const key = `${member.name}-${dateStr}`;
                            newAssignments[key] = {
                                location: formData.location,
                                task: formData.task,
                                desk: formData.desk,
                                classification: formData.classification,
                                clientName: formData.clientName || ''
                            };
                        });
                    }
                    
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                if (Object.keys(newAssignments).length > 0) {
                    const dateRangeText = formData.dateRangeType === 'month' 
                        ? currentMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })
                        : `${startDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - ${endDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`;
                    
                    onSave(newAssignments);
                    alert(`Created ${Object.keys(newAssignments).length} assignments for ${dateRangeText}`);
                } else {
                    alert('No assignments created. Please select at least one day of the week.');
                }
            };

            const toggleStaff = (staffName) => {
                setSelectedStaff(prev => 
                    prev.includes(staffName)
                        ? prev.filter(n => n !== staffName)
                        : [...prev, staffName]
                );
            };

            const availableDesks = formData.location === 'Calumet City' ? offices['Calumet City'] :
                                 formData.location === 'Mokena' ? offices['Mokena'] : [];

            return (
                <div style={styles.modalOverlay} onClick={onClose}>
                    <div style={{...styles.modalContent, maxWidth: '700px'}} onClick={(e) => e.stopPropagation()}>
                        <div style={styles.modalHeader}>
                            <h2 style={styles.modalTitle}>
                                Bulk Schedule - {selectedTeam} - {currentMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}
                            </h2>
                            <button onClick={onClose} style={styles.closeButton}>√ó</button>
                        </div>

                        <form onSubmit={handleSubmit}>
                            <div style={styles.formGroup}>
                                <label style={styles.label}>Apply to Staff</label>
                                <select
                                    value={formData.applyToStaff}
                                    onChange={(e) => setFormData({...formData, applyToStaff: e.target.value})}
                                    style={styles.input}
                                >
                                    <option value="all">All Team Members ({teamMembers.length})</option>
                                    <option value="selected">Selected Team Members</option>
                                </select>
                            </div>

                            {formData.applyToStaff === 'selected' && (
                                <div style={styles.formGroup}>
                                    <label style={styles.label}>Select Staff Members</label>
                                    <div style={styles.staffCheckboxList}>
                                        {teamMembers.map(member => (
                                            <label key={member.name} style={styles.checkboxLabel}>
                                                <input
                                                    type="checkbox"
                                                    checked={selectedStaff.includes(member.name)}
                                                    onChange={() => toggleStaff(member.name)}
                                                    style={styles.checkbox}
                                                />
                                                {member.name} ({member.role})
                                            </label>
                                        ))}
                                    </div>
                                </div>
                            )}

                            <div style={styles.formGroup}>
                                <label style={styles.label}>Date Range</label>
                                <select
                                    value={formData.dateRangeType}
                                    onChange={(e) => setFormData({...formData, dateRangeType: e.target.value})}
                                    style={styles.input}
                                >
                                    <option value="month">Current Month ({currentMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })})</option>
                                    <option value="custom">Custom Date Range</option>
                                </select>
                            </div>

                            {formData.dateRangeType === 'custom' && (
                                <div style={styles.formGroup}>
                                    <label style={styles.label}>Custom Date Range</label>
                                    <div style={styles.dateRangeInputs}>
                                        <div style={{flex: 1}}>
                                            <label style={{...styles.label, fontSize: '12px', marginBottom: '5px'}}>Start Date</label>
                                            <input
                                                type="date"
                                                value={formData.startDate}
                                                onChange={(e) => setFormData({...formData, startDate: e.target.value})}
                                                style={styles.input}
                                                required
                                            />
                                        </div>
                                        <div style={{flex: 1}}>
                                            <label style={{...styles.label, fontSize: '12px', marginBottom: '5px'}}>End Date</label>
                                            <input
                                                type="date"
                                                value={formData.endDate}
                                                onChange={(e) => setFormData({...formData, endDate: e.target.value})}
                                                style={styles.input}
                                                required
                                            />
                                        </div>
                                    </div>
                                    <div style={{fontSize: '12px', color: '#718096', marginTop: '8px'}}>
                                        üí° Perfect for client engagements lasting multiple weeks
                                    </div>
                                </div>
                            )}

                            <div style={styles.formGroup}>
                                <label style={styles.label}>Days of Week</label>
                                <div style={styles.daysOfWeekGrid}>
                                    {Object.keys(formData.daysOfWeek).map(day => (
                                        <label key={day} style={styles.dayCheckboxLabel}>
                                            <input
                                                type="checkbox"
                                                checked={formData.daysOfWeek[day]}
                                                onChange={(e) => setFormData({
                                                    ...formData,
                                                    daysOfWeek: {...formData.daysOfWeek, [day]: e.target.checked}
                                                })}
                                                style={styles.checkbox}
                                            />
                                            {day.charAt(0).toUpperCase() + day.slice(1)}
                                        </label>
                                    ))}
                                </div>
                            </div>

                            <div style={styles.formGroup}>
                                <label style={styles.label}>Location</label>
                                <select
                                    value={formData.location}
                                    onChange={(e) => setFormData({...formData, location: e.target.value, desk: '', clientName: ''})}
                                    style={styles.input}
                                    required
                                >
                                    <option value="">Select location...</option>
                                    <option value="Calumet City">Calumet City</option>
                                    <option value="Mokena">Mokena</option>
                                    <option value="WFH">Work From Home</option>
                                    <option value="Client">Client Site</option>
                                    <option value="PTO">PTO/Off</option>
                                    <option value="Holiday">Holiday</option>
                                </select>
                            </div>

                            {formData.location === 'Client' && (
                                <div style={styles.formGroup}>
                                    <label style={styles.label}>Client Name</label>
                                    <input
                                        type="text"
                                        value={formData.clientName || ''}
                                        onChange={(e) => setFormData({...formData, clientName: e.target.value})}
                                        style={styles.input}
                                        placeholder="e.g., Smith & Associates, ABC Corp"
                                        required
                                    />
                                </div>
                            )}

                            <div style={styles.formGroup}>
                                <label style={styles.label}>Task/Project Description</label>
                                <textarea
                                    value={formData.task}
                                    onChange={(e) => setFormData({...formData, task: e.target.value})}
                                    style={{...styles.input, ...styles.textarea}}
                                    placeholder="Describe the recurring task or project..."
                                    required
                                />
                            </div>

                            {(formData.location === 'Calumet City' || formData.location === 'Mokena') && (
                                <div style={styles.formGroup}>
                                    <label style={styles.label}>
                                        Desk Assignment (Optional)
                                        {conflictWarning && (
                                            <span style={styles.conflictWarning}>
                                                {conflictWarning}
                                            </span>
                                        )}
                                    </label>
                                    <select
                                        value={formData.desk}
                                        onChange={(e) => setFormData({...formData, desk: e.target.value})}
                                        style={{
                                            ...styles.input,
                                            ...(conflictWarning ? styles.inputConflict : {})
                                        }}
                                    >
                                        <option value="">No desk assigned</option>
                                        {availableDesks.map(desk => (
                                            <option key={desk} value={desk}>{desk}</option>
                                        ))}
                                    </select>
                                    {!conflictWarning && (
                                        <div style={{fontSize: '12px', color: '#718096', marginTop: '5px'}}>
                                            üí° Tip: Desk conflicts will be checked automatically as you select options above.
                                        </div>
                                    )}
                                </div>
                            )}

                            <div style={styles.formGroup}>
                                <label style={styles.label}>Classification</label>
                                <select
                                    value={formData.classification}
                                    onChange={(e) => setFormData({...formData, classification: e.target.value})}
                                    style={styles.input}
                                >
                                    <option value="Audit">Audit</option>
                                    <option value="Consulting">Consulting</option>
                                    <option value="Both">Both</option>
                                </select>
                            </div>

                            <div style={styles.bulkSchedulePreview}>
                                <strong>Preview:</strong> {(() => {
                                    if (formData.dateRangeType === 'custom' && (!formData.startDate || !formData.endDate)) {
                                        return 'Select dates to see assignment count.';
                                    }
                                    
                                    const { start, end } = getDateRange();
                                    const dayMapping = {
                                        sunday: 0, monday: 1, tuesday: 2, wednesday: 3,
                                        thursday: 4, friday: 5, saturday: 6
                                    };
                                    
                                    let matchingDays = 0;
                                    const currentDate = new Date(start);
                                    while (currentDate <= end) {
                                        const dayOfWeek = currentDate.getDay();
                                        const dayName = Object.keys(dayMapping).find(k => dayMapping[k] === dayOfWeek);
                                        if (formData.daysOfWeek[dayName]) {
                                            matchingDays++;
                                        }
                                        currentDate.setDate(currentDate.getDate() + 1);
                                    }
                                    
                                    const staffCount = formData.applyToStaff === 'all' ? teamMembers.length : selectedStaff.length;
                                    const totalAssignments = matchingDays * staffCount;
                                    
                                    const dateRangeText = formData.dateRangeType === 'month'
                                        ? currentMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })
                                        : `${start.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - ${end.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`;
                                    
                                    return `This will create ${totalAssignments} assignments (${matchingDays} days √ó ${staffCount} staff) for ${dateRangeText}.`;
                                })()}
                            </div>

                            <div style={styles.buttonGroup}>
                                <button type="submit" style={styles.saveButton}>
                                    Create Bulk Assignments
                                </button>
                                <button type="button" onClick={onClose} style={styles.cancelButton}>
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        const styles = {
            container: {
                fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
                minHeight: '100vh',
                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                padding: '20px'
            },
            header: {
                background: 'linear-gradient(135deg, #4a5568 0%, #2d3748 100%)',
                color: 'white',
                padding: '30px',
                borderRadius: '20px 20px 0 0',
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                flexWrap: 'wrap',
                gap: '20px'
            },
            title: {
                fontSize: '28px',
                fontWeight: '700',
                margin: 0
            },
            headerControls: {
                display: 'flex',
                gap: '15px',
                flexWrap: 'wrap'
            },
            weekNav: {
                display: 'flex',
                alignItems: 'center',
                gap: '10px',
                background: 'rgba(255,255,255,0.1)',
                padding: '10px 15px',
                borderRadius: '10px'
            },
            navButton: {
                background: 'white',
                color: '#2d3748',
                border: 'none',
                padding: '8px 15px',
                borderRadius: '5px',
                cursor: 'pointer',
                fontWeight: '600',
                transition: 'all 0.3s'
            },
            weekDisplay: {
                color: 'white',
                fontWeight: '600',
                minWidth: '200px',
                textAlign: 'center'
            },
            viewToggle: {
                display: 'flex',
                gap: '5px',
                background: 'rgba(255,255,255,0.1)',
                padding: '5px',
                borderRadius: '10px'
            },
            viewButton: {
                background: 'transparent',
                color: 'white',
                border: 'none',
                padding: '8px 20px',
                borderRadius: '5px',
                cursor: 'pointer',
                fontWeight: '600',
                transition: 'all 0.3s'
            },
            viewButtonActive: {
                background: 'white',
                color: '#2d3748'
            },
            statsBar: {
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                gap: '20px',
                padding: '30px',
                background: '#f7fafc'
            },
            statCard: {
                background: 'white',
                padding: '20px',
                borderRadius: '10px',
                boxShadow: '0 2px 4px rgba(0,0,0,0.1)'
            },
            statValue: {
                fontSize: '32px',
                fontWeight: '700',
                color: '#667eea',
                marginBottom: '5px'
            },
            statLabel: {
                color: '#718096',
                fontSize: '14px'
            },
            teamSelector: {
                display: 'flex',
                gap: '10px',
                padding: '20px 30px',
                background: 'white',
                overflowX: 'auto',
                flexWrap: 'wrap'
            },
            teamButton: {
                padding: '10px 20px',
                border: '2px solid #e2e8f0',
                borderRadius: '8px',
                background: 'white',
                cursor: 'pointer',
                fontWeight: '600',
                color: '#2d3748',
                transition: 'all 0.3s',
                whiteSpace: 'nowrap'
            },
            teamButtonActive: {
                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                color: 'white',
                borderColor: '#667eea'
            },
            scheduleContainer: {
                padding: '30px',
                background: 'white',
                overflowX: 'auto',
                borderRadius: '0 0 20px 20px'
            },
            scheduleGrid: {
                display: 'grid',
                gridTemplateColumns: '200px repeat(7, minmax(150px, 1fr))',
                gap: '2px',
                background: '#e2e8f0',
                borderRadius: '10px',
                overflow: 'hidden',
                minWidth: '1200px'
            },
            gridHeader: {
                background: '#4a5568',
                color: 'white',
                padding: '15px',
                fontWeight: '600',
                textAlign: 'center',
                fontSize: '14px'
            },
            staffColumn: {
                textAlign: 'left',
                background: '#2d3748'
            },
            staffCell: {
                background: '#f7fafc',
                padding: '15px',
                display: 'flex',
                flexDirection: 'column',
                justifyContent: 'center'
            },
            staffName: {
                fontWeight: '600',
                color: '#2d3748',
                marginBottom: '5px'
            },
            staffRole: {
                fontSize: '12px',
                color: '#718096'
            },
            dayCell: {
                background: 'white',
                padding: '10px',
                minHeight: '80px',
                cursor: 'pointer',
                transition: 'all 0.3s'
            },
            dayCellAssigned: {
                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                color: 'white'
            },
            assignment: {
                fontSize: '13px',
                lineHeight: '1.5'
            },
            assignmentLocation: {
                fontWeight: '600',
                marginBottom: '5px'
            },
            assignmentTask: {
                fontSize: '12px',
                opacity: 0.9,
                marginBottom: '5px'
            },
            assignmentDesk: {
                fontSize: '11px',
                padding: '3px 6px',
                background: 'rgba(255,255,255,0.2)',
                borderRadius: '3px',
                display: 'inline-block',
                marginTop: '5px'
            },
            deskView: {
                padding: '30px',
                background: 'white',
                borderRadius: '0 0 20px 20px'
            },
            officeSection: {
                marginBottom: '40px'
            },
            officeTitle: {
                color: '#2d3748',
                marginBottom: '20px',
                fontSize: '22px'
            },
            deskGrid: {
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fill, minmax(200px, 1fr))',
                gap: '15px'
            },
            deskCard: {
                background: 'white',
                border: '2px solid #e2e8f0',
                borderRadius: '10px',
                padding: '20px',
                cursor: 'pointer',
                transition: 'all 0.3s'
            },
            deskCardOccupied: {
                background: 'linear-gradient(135deg, #48bb78 0%, #38a169 100%)',
                color: 'white',
                borderColor: '#38a169'
            },
            deskName: {
                fontWeight: '600',
                marginBottom: '10px',
                fontSize: '16px'
            },
            deskOccupant: {
                fontSize: '14px',
                opacity: 0.9
            },
            modalOverlay: {
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                background: 'rgba(0,0,0,0.7)',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                zIndex: 1000
            },
            modalContent: {
                background: 'white',
                borderRadius: '15px',
                padding: '30px',
                maxWidth: '600px',
                width: '90%',
                maxHeight: '80vh',
                overflowY: 'auto'
            },
            modalHeader: {
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                marginBottom: '25px'
            },
            modalTitle: {
                color: '#2d3748',
                fontSize: '24px',
                margin: 0
            },
            closeButton: {
                background: 'none',
                border: 'none',
                fontSize: '30px',
                cursor: 'pointer',
                color: '#718096',
                lineHeight: 1,
                padding: 0
            },
            formGroup: {
                marginBottom: '20px'
            },
            label: {
                display: 'block',
                marginBottom: '8px',
                fontWeight: '600',
                color: '#2d3748'
            },
            input: {
                width: '100%',
                padding: '12px',
                border: '2px solid #e2e8f0',
                borderRadius: '8px',
                fontSize: '14px',
                transition: 'all 0.3s',
                boxSizing: 'border-box'
            },
            textarea: {
                minHeight: '80px',
                resize: 'vertical',
                fontFamily: 'inherit'
            },
            buttonGroup: {
                display: 'flex',
                gap: '10px',
                marginTop: '25px'
            },
            saveButton: {
                flex: 1,
                padding: '12px 30px',
                border: 'none',
                borderRadius: '8px',
                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                color: 'white',
                fontWeight: '600',
                cursor: 'pointer',
                fontSize: '14px'
            },
            deleteButton: {
                padding: '12px 30px',
                border: 'none',
                borderRadius: '8px',
                background: '#f56565',
                color: 'white',
                fontWeight: '600',
                cursor: 'pointer',
                fontSize: '14px'
            },
            teamManagement: {
                padding: '30px',
                background: 'white',
                borderRadius: '0 0 20px 20px'
            },
            managementHeader: {
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                marginBottom: '30px',
                flexWrap: 'wrap',
                gap: '15px'
            },
            managementTitle: {
                color: '#2d3748',
                fontSize: '28px',
                margin: 0
            },
            addTeamBtn: {
                padding: '12px 24px',
                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                color: 'white',
                border: 'none',
                borderRadius: '8px',
                fontWeight: '600',
                cursor: 'pointer',
                fontSize: '14px'
            },
            teamManagementCard: {
                background: '#f7fafc',
                borderRadius: '12px',
                padding: '25px',
                marginBottom: '20px',
                border: '1px solid #e2e8f0'
            },
            teamCardHeader: {
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                marginBottom: '20px',
                flexWrap: 'wrap',
                gap: '15px'
            },
            teamCardTitle: {
                color: '#2d3748',
                fontSize: '20px',
                margin: 0
            },
            teamCardActions: {
                display: 'flex',
                gap: '10px'
            },
            addStaffBtn: {
                padding: '8px 16px',
                background: '#48bb78',
                color: 'white',
                border: 'none',
                borderRadius: '6px',
                fontWeight: '600',
                cursor: 'pointer',
                fontSize: '13px'
            },
            deleteTeamBtn: {
                padding: '8px 16px',
                background: '#f56565',
                color: 'white',
                border: 'none',
                borderRadius: '6px',
                fontWeight: '600',
                cursor: 'pointer',
                fontSize: '13px'
            },
            staffMembersList: {
                display: 'grid',
                gap: '12px'
            },
            emptyTeam: {
                color: '#718096',
                fontStyle: 'italic',
                margin: 0
            },
            staffMemberCard: {
                background: 'white',
                padding: '15px 20px',
                borderRadius: '8px',
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                border: '1px solid #e2e8f0'
            },
            memberName: {
                fontWeight: '600',
                color: '#2d3748',
                marginBottom: '4px'
            },
            memberRole: {
                fontSize: '14px',
                color: '#718096'
            },
            memberActions: {
                display: 'flex',
                gap: '8px'
            },
            editBtn: {
                padding: '6px 14px',
                background: '#667eea',
                color: 'white',
                border: 'none',
                borderRadius: '5px',
                fontWeight: '600',
                cursor: 'pointer',
                fontSize: '12px'
            },
            removeBtn: {
                padding: '6px 14px',
                background: '#fc8181',
                color: 'white',
                border: 'none',
                borderRadius: '5px',
                fontWeight: '600',
                cursor: 'pointer',
                fontSize: '12px'
            },
            monthCalendarHeader: {
                display: 'grid',
                gridTemplateColumns: 'repeat(7, 1fr)',
                gap: '2px',
                background: '#e2e8f0',
                borderRadius: '10px 10px 0 0',
                overflow: 'hidden',
                marginBottom: '2px'
            },
            monthDayHeader: {
                background: '#4a5568',
                color: 'white',
                padding: '15px',
                fontWeight: '600',
                textAlign: 'center',
                fontSize: '14px'
            },
            monthCalendarGrid: {
                display: 'grid',
                gridTemplateColumns: 'repeat(7, 1fr)',
                gap: '2px',
                background: '#e2e8f0',
                borderRadius: '0 0 10px 10px',
                overflow: 'hidden',
                minHeight: '500px'
            },
            monthDayCell: {
                background: 'white',
                padding: '10px',
                minHeight: '100px',
                cursor: 'pointer',
                transition: 'all 0.3s',
                display: 'flex',
                flexDirection: 'column'
            },
            monthEmptyCell: {
                background: '#f7fafc'
            },
            monthDayNumber: {
                fontWeight: '600',
                color: '#2d3748',
                marginBottom: '8px',
                fontSize: '14px'
            },
            monthAssignments: {
                display: 'flex',
                flexDirection: 'column',
                gap: '4px',
                flex: 1
            },
            monthAssignmentBadge: {
                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                color: 'white',
                padding: '4px 8px',
                borderRadius: '4px',
                fontSize: '11px',
                fontWeight: '500',
                cursor: 'pointer',
                transition: 'all 0.2s',
                whiteSpace: 'nowrap',
                overflow: 'hidden',
                textOverflow: 'ellipsis'
            },
            addAssignmentBtn: {
                background: '#e2e8f0',
                color: '#4a5568',
                padding: '4px 8px',
                borderRadius: '4px',
                fontSize: '11px',
                fontWeight: '600',
                cursor: 'pointer',
                textAlign: 'center',
                transition: 'all 0.2s',
                marginTop: 'auto'
            },
            conflictWarning: {
                color: '#f56565',
                fontSize: '12px',
                marginLeft: '10px',
                fontWeight: '600'
            },
            inputConflict: {
                borderColor: '#f56565',
                background: '#fff5f5'
            },
            bulkScheduleButton: {
                padding: '8px 20px',
                background: '#48bb78',
                color: 'white',
                border: 'none',
                borderRadius: '8px',
                fontWeight: '600',
                cursor: 'pointer',
                fontSize: '14px',
                transition: 'all 0.3s'
            },
            staffCheckboxList: {
                display: 'grid',
                gap: '10px',
                padding: '10px',
                background: '#f7fafc',
                borderRadius: '8px',
                maxHeight: '200px',
                overflowY: 'auto'
            },
            checkboxLabel: {
                display: 'flex',
                alignItems: 'center',
                gap: '10px',
                cursor: 'pointer',
                padding: '8px',
                background: 'white',
                borderRadius: '5px',
                transition: 'all 0.2s'
            },
            checkbox: {
                width: '18px',
                height: '18px',
                cursor: 'pointer'
            },
            daysOfWeekGrid: {
                display: 'grid',
                gridTemplateColumns: 'repeat(auto-fit, minmax(120px, 1fr))',
                gap: '10px',
                padding: '10px',
                background: '#f7fafc',
                borderRadius: '8px'
            },
            dayCheckboxLabel: {
                display: 'flex',
                alignItems: 'center',
                gap: '8px',
                padding: '8px',
                background: 'white',
                borderRadius: '5px',
                cursor: 'pointer',
                fontSize: '14px',
                fontWeight: '500'
            },
            bulkSchedulePreview: {
                padding: '15px',
                background: '#ebf8ff',
                borderRadius: '8px',
                color: '#2c5282',
                fontSize: '14px',
                marginTop: '15px',
                border: '1px solid #bee3f8'
            },
            cancelButton: {
                padding: '12px 30px',
                border: '2px solid #e2e8f0',
                borderRadius: '8px',
                background: 'white',
                color: '#2d3748',
                fontWeight: '600',
                cursor: 'pointer',
                fontSize: '14px'
            },
            dateRangeInputs: {
                display: 'flex',
                gap: '15px',
                alignItems: 'flex-end'
            },
            loadingContainer: {
                display: 'flex',
                flexDirection: 'column',
                alignItems: 'center',
                justifyContent: 'center',
                minHeight: '100vh',
                gap: '20px'
            },
            loadingSpinner: {
                width: '60px',
                height: '60px',
                border: '6px solid rgba(255,255,255,0.3)',
                borderTop: '6px solid white',
                borderRadius: '50%',
                animation: 'spin 1s linear infinite'
            },
            loadingText: {
                color: 'white',
                fontSize: '18px',
                fontWeight: '600'
            }
        };

        // Add CSS animation for spinner
        const styleSheet = document.createElement('style');
        styleSheet.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(styleSheet);

        ReactDOM.render(<SchedulingApp />, document.getElementById('root'));
    </script>
</body>
</html>
